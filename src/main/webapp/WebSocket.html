<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>websocket客户端</title>
		<script type="text/javascript">
			var socket;
			if(!window.WebSocket){
				window.WebSocket = window.MozWebsocket;
			}
			if(window.WebSocket){
				socket = new WebSocket("ws://localhost:8080/websocket");
				
				socket.onmessage = function(event){
					console.log(event.data);
			        if(event.data=="1"){
			            console.log("数据更新啦");
			        }
					var ta = document.getElementById("responseContent");
					ta.value += event.data + "\r\n";
					/* makeDataOnWeb(event.data); */
				};
				/* function makeDataOnWeb(data) {
		            var a = data;
		            var divNode = document.getElementById("view");
		            var liNode = document.createElement("li");
		            liNode.innerHTML = a;
		            divNode.appendChild(liNode);
				}; */
				socket.onopen = function(event){
					var ta = document.getElementById("responseContent");
					ta.value = "您当前的浏览器支持websocket请进行后续操作\r\n";
				};
				socket.onclose = function(event){
					var ta = document.getElementById("responseContent");
					ta.value = "";
					ta.value = "websocket链接关闭\r\n";
				}
			}else{
				alert("您的浏览器不支持websocket");
			}
			function send(message){
				if(!window.WebSocket){
					return;
				}
				alert(socket.readyState);
				if(socket.readyState == WebSocket.OPEN){
					socket.send(message);
				}else{
					alert('websocket链接没有建立成功');
				}
			}
		</script>
	</head>
	<body>
		<form onsubmit="return false">
			<input type = "text" name = "message" value = ""/>
			<br/><br/>
			<input type = "button" value = "发送WebSocket请求消息" onclick = "send(this.form.message.value)"/>
			<hr color="red" />
			<h2>客户端接收应答</h2>
			<textarea id="responseContent" style="width: 300px;height: 200px;"></textarea>
		</form>	
		<div id="view">

		</div>	
	</body>
</html>
